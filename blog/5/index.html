
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>learn</title>
  <meta name="author" content="Ankit">

  
  <meta name="description" content="Memory Allocation/Memory Management Act of managing computer memory. Essential requirement is to provide ways to dynamically allocate memory to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://goyalankit.github.io/notes-blog/blog/5/">
  <link href="/notes-blog/favicon.png" rel="icon">
  <link href="/notes-blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
   <link href="/notes-blog/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/notes-blog/javascripts/modernizr-2.0.js"></script>
  <script src="/notes-blog/javascripts/ender.js"></script>
  <script src="/notes-blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="atom.xml" rel="alternate" title="learn" type="application/atom+xml">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:200,300,400,500,600,700,900' rel='stylesheet' type='text/css'>




  

  </head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
   <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:goyalankit.github.io/notes-blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/notes-blog/">Blog</a></li>
  <li><a href="/notes-blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/notes-blog/blog/2014/09/05/basic-os-concepts/">Basic Os Concepts</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-05T07:38:52+05:30" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Memory Allocation/Memory Management</h3>

<blockquote><p>Act of managing computer memory. Essential requirement is to provide ways to dynamically allocate memory to programs at their request and free when not needed.</p></blockquote>

<ol>
<li><strong>Memory Pools/Fixed-size block allocation</strong>: uses a free list of often same size block of memory and allocates on request. This works well for embedded systems.</li>
<li><strong>buddy blocks</strong>: In this system memory is allocated from several blocks instead of just one. Memory pools often represent blocks of size of power 2. When a certain size of memory is requested, the pool with minimum size meeting the requirements is used to allocate memory. If no such block is present, a block from higher pool is broken into smaller blocks and then memory is allocated.</li>
</ol>


<h3>Fragmentation</h3>

<blockquote><p>Three types: External, Internal and Data fragmentation</p></blockquote>

<p>Since the memory is often assigned in blocks of power 2, there would be a waste of memory either internally or externally. Overtime while memory is getting allocated and released, there will holes in between. If there are holes outside the allocated area, it&rsquo;s called external fragmentation and if there are holes inside the allocated area it&rsquo;s called internal fragmentation.
Data fragmentation occurs when a collection of data in memory is broken into pieces that are not closed together. For example, a file that is not able to fit in contiguous memory.</p>

<h3>Translation look-aside buffer (TLB)</h3>

<p>A cache that <strong>Memory Management Unit</strong> uses to improve virtual address translation speed.</p>

<p>Virtual memory is the space seen from a process. The page table keeps track of where the virtual pages are stored in the physical memory. The TLB is implemented as CAM (content addressable memory). CAM key is virtual address and search result is the physical address. If there&rsquo;s a miss in TLB, translation proceeds by <strong>page walk</strong>.</p>

<h3>Interrupt</h3>

<p>Interrupt is a signal to the processor emitted by software or hardware indicating an event that needs immediate attention. The processor responds by suspending its current activities, saving its state and executing a function called interrupt handler (or interrupt service routine, ISR).</p>

<p><strong>Hardware Interrupts</strong> are used by devices to communicate that they require special attention. Internally they are generated by sending alerting signals to the processors. Basically give each device a wire (interrupt line) that it can use to signal processor. Hardware interrupts are <strong>asynchronous</strong>.</p>

<p><strong>Software Interrupts</strong> is cause either by an exceptional condition in the processor itself or a special instruction in the instruction set which causes an interrupt when executed. The former is often called a <strong>trap</strong> (<strong>Divide by 0 causes trap</strong>)
Special instruction is used to interrupt to request services from low level system software such as device drivers. Software interrupts are often used to implement system calls.</p>

<p><img src="http://i.imgur.com/cBhat6K.png"></p>

<p>Several ways to implement interrupts. Could be implemented using a active wire (level triggered, high or low), edge triggered, message signaled, Doorbell <a href="http://en.wikipedia.org/wiki/Interrupt">wiki link</a>.</p>

<h3>Distributed Shared Memory</h3>

<p>Physically separate memories can be addressed globally. Two processors with same address will point to same memory address. Can be implemented at OS level or library level.</p>

<h4>Stateful and stateless servers</h4>

<p>A stateful server remembers client data from previous request whereas stateless server doesn&rsquo;t.</p>

<p>State may refer to any information related to client like whether the file is open, or being modified or cached data on client etc.</p>

<p>NFS is a stateless system.
- Each request must be complete since no state is stored - the file has to fully identified and any offsets specified.
- if a server crashes and then recovers, no info was lost since it&rsquo;s stateless. higher degree of fault tolerence.
- no server overhead for storing client information, and server doesn&rsquo;t get affected if client crashes.</p>

<p>AFS is stateful System
- Requests are shorter
- cache coherence is possible; server can know which clients are caching which blocks of a file.
- File locking is possible; server can maintain that certain client is locking a file.
- server returns an identifier to client creating a session and keeps track of open files. It is required to maintain state if providing unix file semantics.</p>

<h4>Difference between stateful and stateless file systems</h4>

<ul>
<li>Failure Recovery:

<ul>
<li>A stateful server loses all its valatile state in a crash. Server needs to be aware of client failure to reclaim memory.</li>
</ul>
</li>
<li>Slow processing and longer request messages in case of stateless systems. Difficult to provide unix file semantics.</li>
<li>A server employing server-iniitiated cache needs to have state to validate cache.</li>
<li>UNIX use of file descriptors and implicit offsets is inherently stateful. servers must maintain tables to map file descriptors to inodes and store current offset within file.</li>
</ul>


<p><a href="http://www.cs.gmu.edu/~setia/cs571-F02/slides/lec9.pdf">Detailed Info</a></p>

<h3>Swapping</h3>

<p>When all the process in a multiprogrammed CPU are not able reside in memory at the same time, some of the process that are not scheduled currently or are blocked are transferred to secondary memory. This dynamic moving of process between memotu and disk is called swapping.</p>

<h3>Inverted Page Table</h3>

<p><img src="http://i.imgur.com/ItoPoXI.jpg?1" width="500"></p>

<p>Linear Inverted Tables: Rather than mapping virtual addresses to physical addresses, we map physical address to virtual addresses.
<a href="http://www.cs.berkeley.edu/~kamil/teaching/sp04/040104.pdf">http://www.cs.berkeley.edu/~kamil/teaching/sp04/040104.pdf</a></p>

<h3>File Systems</h3>

<blockquote><p>Give at least three strategies that a file system can employ to reduce the time a program spends waiting for data reads to complete.</p></blockquote>

<ul>
<li>Prefetching (Spatial Locality) - A process doing random access will not get the benifits.</li>
<li>Indexing (Index Most Used Paths) - Accessing files that are not used commonly will be effected.</li>
<li>Caching - If the data is being changed rapidly, cache will become stale soon and benifits will diminish.</li>
</ul>


<p><a href="http://duartes.org/gustavo/blog/post/anatomy-of-a-program-in-memory/">http://duartes.org/gustavo/blog/post/anatomy-of-a-program-in-memory/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/notes-blog/blog/2014/09/05/kernel-compilation-notes/">Kernel Compilation Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-05T02:27:47+05:30" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Kernel Versions</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Guest
</span><span class='line'>goyal@fyra:~$ uname -a
</span><span class='line'>Linux fyra 3.13.0-34-generic #60-Ubuntu SMP Wed Aug 13 15:45:27 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux
</span><span class='line'>
</span><span class='line'>#Host
</span><span class='line'>ankit@ubuntu2:~$ uname -a
</span><span class='line'>Linux ubuntu2 3.16.1 #1 SMP Thu Sep 4 18:57:37 CDT 2014 x86_64 GNU/Linux</span></code></pre></td></tr></table></div></figure>


<h3>Create VM</h3>

<ul>
<li>Install KVM and it&rsquo;s dependencies.</li>
<li>Create a Ubuntu VM using VMBuilder</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo vmbuilder kvm ubuntu     <span class="se">\</span>
</span><span class='line'>    --arch i386               <span class="se">\</span>
</span><span class='line'>    --user ankit              <span class="se">\</span>
</span><span class='line'>    --name ankit              <span class="se">\</span>
</span><span class='line'>    --pass cracker            <span class="se">\</span>
</span><span class='line'>    --suite lucid             <span class="se">\</span>
</span><span class='line'>    --flavour virtual         <span class="se">\</span>
</span><span class='line'>    --addpkg openssh-server   <span class="se">\</span>
</span><span class='line'>    --libvirt qemu:///system
</span></code></pre></td></tr></table></div></figure>


<h4>.qcow image</h4>

<p>qcow is a file format for disk image files used by QEMU, a hosted virtual machine monitor.
the old QEMU copy-on-write format, supported for historical reasons and superseded by qcow2</p>

<h3>.qcow2 image</h3>

<p>QEMU copy-on-write format with a range of special features, including the ability to take multiple snapshots, smaller images on filesystems that don&rsquo;t support sparse files, optional AES encryption, and optional zlib compression</p>

<ul>
<li><strong>Basic Commands</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>  arp -n <span class="c"># to find out what ip address was assined to the VM.</span>
</span><span class='line'>
</span><span class='line'>  virsh --connect qemu:///system list --all <span class="c"># to list all the vms</span>
</span><span class='line'>
</span><span class='line'>  virsh --connect qemu:///system start ubuntu <span class="c"># to start the vm with name ubuntu</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>For clean shutdown install <strong>acpid</strong> inside the guest OS. <code>sudo apt-get install acpid</code>.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>virsh --connect qemu:///system shutdown ubuntu <span class="c"># to shutdown the vm</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>virsh</code> is a tool that provides interface to libvrt deamon.</p>

<p><code>qemu-</code></p>

<h4>Run the Virtual Machine using KVM</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>kvm -drive <span class="nv">file</span><span class="o">=</span>tmpYPpuMh.qcow2 --snapshot
</span></code></pre></td></tr></table></div></figure>


<h3>Run the VM using qemu-system</h3>

<p>This configuration allows guest to access outside world but not vice-versa. It forwards 22 port so that host can connect to VM over ssh.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>qemu-system-x86_64 -drive <span class="nv">file</span><span class="o">=</span>tmpPKS3JS.qcow2 --snapshot -net nic,model<span class="o">=</span>virtio -net user -redir tcp:2222::22
</span></code></pre></td></tr></table></div></figure>


<p>To connect to guest</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ssh -p <span class="m">2222</span> ankit@localhost
</span></code></pre></td></tr></table></div></figure>


<h3>Mount image on local filesystem</h3>

<h4>Network Block Device (nbd)</h4>

<p>From Wikipedia:</p>

<p>In Linux, a network block device is a device node whose content is provided by a remote machine. Typically, network block devices are used to access a storage device that does not physically reside in the local machine but on a remote one. As an example, the local machine can access a fixed disk that is attached to another computer.</p>

<ul>
<li>Load the <strong>nbd</strong> module in current kernel</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo modprobe nbd <span class="nv">max_part</span><span class="o">=</span>8
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>create a device entry for the disk</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo qemu-nbd --connect<span class="o">=</span>/dev/nbd0 file.qcow2
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Mount the device on mount point</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo mount /dev/nbd0p1 /mnt/kvm
</span><span class='line'><span class="nb">cd</span> /mnt/kvm <span class="c"># should show you the filesystem of VM</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Unmount</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo umount /mnt/kvm
</span><span class='line'>sudo nbd-client -d /dev/nbd0
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>Compile the kernel</h3>

<ul>
<li>Download and extract source from <a href="http://kernel.org">http://kernel.org</a></li>
<li>Create a separate kbuild directory.</li>
<li>Prepare kernel for compilation by cleaning the source directory</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>make mrproper
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Create configuration file in kbuild directory</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yes <span class="s2">&quot;&quot;</span> <span class="p">|</span> make -C &lt;kernel dir&gt; <span class="nv">O</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span> config
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Set <code>CONFIG_SATA_AHCI=y</code> in .config file so that SATA disk driver is built into kernel and not as a module. This will allow kernel to boot off a virtual SATA drive without having to load a module.</li>
<li>Build the kernel by running make in kbuild</li>
</ul>


<hr />

<h4>Boot the kernel</h4>

<ul>
<li>Tell kernel that root of the filesystem is <code>/dev/sda1</code></li>
<li>Set the console to <code>ttyS0</code> so that we can see the logs.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo qemu-system-x86_64 -drive <span class="nv">file</span><span class="o">=</span>tmpPKS3JS.qcow2 --snapshot -net nic,model<span class="o">=</span>virtio -net user -redir tcp:2222::22 -nographic -kernel ~/workspace/kernel/kbuild/arch/x86_64/boot/bzImage -boot c -append <span class="s2">&quot;root=/dev/sda1 console=ttyS0,115200n8 console=ttyS0&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Use SSH to login to the machine</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ssh -p <span class="m">2222</span> ankit@localhost
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Create a new file /etc/init/ttyS0.conf</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># ttyS0 - getty</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># This service maintains a getty on ttyS0 from the point the system is</span>
</span><span class='line'><span class="c"># started until it is shut down again.</span>
</span><span class='line'>start on stopped rc or <span class="nv">RUNLEVEL</span><span class="o">=[</span>2345<span class="o">]</span>
</span><span class='line'>stop on runlevel <span class="o">[</span>!2345<span class="o">]</span>
</span><span class='line'>respawn
</span><span class='line'><span class="nb">exec</span> /sbin/getty -L <span class="m">115200</span> ttyS0 vt102
</span></code></pre></td></tr></table></div></figure>


<h3>Debuggin Kernel</h3>

<p>There are several ways to start gdbserver so that gdb can attach remotely.</p>

<p>You can either start the VM using <code>-s</code> flag and then you can attach gdb remotely. Note: <code>-s</code> is equivalent to <code>-gdb tcp::1234</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo qemu-system-x86_64 -drive <span class="nv">file</span><span class="o">=</span>tmpPKS3JS.qcow2 --snapshot -net nic,model<span class="o">=</span>virtio -net user -redir tcp:2222::22 -nographic -kernel ~/workspace/kernel/kbuild/arch/x86_64/boot/bzImage -boot c -append <span class="s2">&quot;root=/dev/sda1 console=ttyS0,115200n8 console=ttyS0&quot;</span> -s
</span></code></pre></td></tr></table></div></figure>


<p>To attach gdb remotely:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bash&gt; gdb workspace/kernel/kbuild/vmlinux
</span><span class='line'>gdb&gt; target remote:1234
</span></code></pre></td></tr></table></div></figure>


<p>More Info: <a href="http://people.eecs.ku.edu/~kpoduval/UMOD/kvm_gdb.html">http://people.eecs.ku.edu/~kpoduval/UMOD/kvm_gdb.html</a></p>

<p>OR</p>

<h4>Qemu monitor</h4>

<p>Another way to start gdbserver is by using qemu-monitor console. User <code>ctrl + alt + shift + 2</code> to go to qemu console and run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">(</span>qemu<span class="o">)</span> gdbserver
</span></code></pre></td></tr></table></div></figure>


<h5>Other useful qemu monitor commands</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">(</span>qemu<span class="o">)</span> commit all <span class="c"># Commit your changes to image when running using -snapshot option</span>
</span><span class='line'>
</span><span class='line'><span class="o">(</span>qemu<span class="o">)</span> system_powerdown <span class="c"># to shutdown vm cleanly</span>
</span></code></pre></td></tr></table></div></figure>


<p>More on qemu monitor: <a href="http://en.wikibooks.org/wiki/QEMU/Monitor">http://en.wikibooks.org/wiki/QEMU/Monitor</a></p>

<p>Information on registers, commands:</p>

<p><a href="http://www.cs.nyu.edu/~mwalfish/classes/ut/s12-cs372h/labs/labguide.html#make">http://www.cs.nyu.edu/~mwalfish/classes/ut/s12-cs372h/labs/labguide.html#make</a></p>

<h4>Debugging process</h4>

<p>Program used for debugging:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include&lt;unistd.h&gt;</span>
</span><span class='line'><span class="cp">#include&lt;fcntl.h&gt;</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&quot;/dev/urandom&quot;</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mi">4096</span><span class="p">];</span>
</span><span class='line'>  <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">4096</span><span class="p">);</span>
</span><span class='line'>  <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&quot;/dev/null&quot;</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="p">);</span>
</span><span class='line'>  <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">4096</span><span class="p">);</span>
</span><span class='line'>  <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>swapper is an idle process with id = 0. It runs when no other process is runnnin.</li>
</ul>


<h3>Errors</h3>

<p>Ignore these errors. These errors occurs irrespective of how you launch the kernel.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="nl">init</span><span class="p">:</span> <span class="n">plymouth</span> <span class="n">main</span> <span class="n">process</span> <span class="p">(</span><span class="mi">80</span><span class="p">)</span> <span class="n">killed</span> <span class="n">by</span> <span class="n">SEGV</span> <span class="n">signal</span>
</span><span class='line'><span class="nl">init</span><span class="p">:</span> <span class="n">plymouth</span><span class="o">-</span><span class="n">splash</span> <span class="n">main</span> <span class="n">process</span> <span class="p">(</span><span class="mi">312</span><span class="p">)</span> <span class="n">terminated</span> <span class="n">with</span> <span class="n">status</span> <span class="mi">2</span>
</span><span class='line'><span class="nl">mountall</span><span class="p">:</span> <span class="n">Plymouth</span> <span class="n">command</span> <span class="n">failed</span>
</span><span class='line'><span class="nl">mountall</span><span class="p">:</span> <span class="n">Plymouth</span> <span class="n">command</span> <span class="n">failed</span>
</span><span class='line'><span class="nl">mountall</span><span class="p">:</span> <span class="n">Plymouth</span> <span class="n">command</span> <span class="n">failed</span>
</span><span class='line'><span class="nl">mountall</span><span class="p">:</span> <span class="n">Plymouth</span> <span class="n">command</span> <span class="n">failed</span>
</span><span class='line'><span class="nl">mountall</span><span class="p">:</span> <span class="n">Disconnected</span> <span class="n">from</span> <span class="n">Plymouth</span>
</span><span class='line'><span class="nl">init</span><span class="p">:</span> <span class="n">plymouth</span><span class="o">-</span><span class="n">log</span> <span class="n">main</span> <span class="n">process</span> <span class="p">(</span><span class="mi">323</span><span class="p">)</span> <span class="n">terminated</span> <span class="n">with</span> <span class="n">status</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>useful links:
<a href="http://www.linuxchix.org/content/courses/kernel_hacking/lesson8">http://www.linuxchix.org/content/courses/kernel_hacking/lesson8</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/notes-blog/blog/2014/09/04/slash-udev-notes/">/udev Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-04T12:43:15+05:30" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Problems with <code>/dev</code></h3>

<ol>
<li>A static /dev is unwiedly big. It would be nice to show only /dev enteries for the devices that we acutally have running in the system.</li>
<li>We are running out of major and minor number for devices.</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>  <span class="o">[</span>vagrant@vagrant-centos64 ~<span class="o">]</span><span class="nv">$ </span>ls -l /dev/sda
</span><span class='line'>  brw-rw---- <span class="m">1</span> root disk 8, <span class="m">0</span> Aug <span class="m">14</span> 05:36 /dev/sda
</span><span class='line'>
</span><span class='line'>  <span class="c"># shows permissions (brw-rw---- ), owner (root), group (disk), major device number (8), </span>
</span><span class='line'>    minor device number <span class="o">(</span>0<span class="o">)</span>, date <span class="o">(</span>Aug 14<span class="o">)</span>, hour <span class="o">(</span>05:36<span class="o">)</span> and device name
</span></code></pre></td></tr></table></div></figure>


<p>  When accessing a device file, the major device number selects which device driver is being called to perform read/write. Minor number is passed as a parameter and its usage/interpretations depends on the driver.<br/></p>

<ol>
<li>Users want a way to name devices in persistant fashion.</li>
<li>Userspace programs wants to know what devices are created or removed and what /dev entry is associated with them.</li>
</ol>


<h3><code>udev</code></h3>

<p>Presentation on udev: <a href="http://www.kroah.com/linux/talks/ols_2003_udev_talk/mgp00001.html">http://www.kroah.com/linux/talks/ols_2003_udev_talk/mgp00001.html</a></p>

<ol>
<li>the /dev tree is populated only for devices that are currently present in the system.</li>
<li>udev doesn&rsquo;t care about major or minor number schemes.</li>
<li>It provides ability to name devices persistently.</li>
<li>udev emites D-BUS messages so that any userspace program can listen to what devices are created or removed. Userspace programs can also query the database to see what devices are present and what they are currently named.</li>
</ol>


<h3>Dynamic <code>/dev</code></h3>

<p>The content of /dev directory are stored on a temporary file system and all files are render at every system startup. Static files that should always be present in /dev directory can be placed in /lib/udev/devices directory. All the contents of /lib/udev/devices directory are copied to /dev at startup.</p>

<blockquote><p>how does kernel knows which device driver to choose without major or minor device number.</p></blockquote>

<p>The kernel bus drivers probe for devices. For every detected devices kernel creates an internal device structure and sends a uevent to udev deamon. Each devices identifies itself by specially-formatted ID, which tells what kind of device it is. It usually consists of vendor ID, product ID and other subsystem specific values.</p>

<p><code>/etc/udev/rules.d/*.rules</code> contains rules for different devices and <code>udev</code> deamon parses and loads all of them at the startup.</p>

<p>More Info at:
<a href="http://doc.opensuse.org/products/draft/SLES/SLES-admin_sd_draft/cha.udev.html#sec.udev.devdir">http://doc.opensuse.org/products/draft/SLES/SLES-admin_sd_draft/cha.udev.html#sec.udev.devdir</a></p>

<hr/>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/notes-blog/blog/2014/09/03/the-unix-time-sharing-system-notes/">The Unix Time-Sharing System Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-03T10:49:07+05:30" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>source</strong>: <a href="http://cm.bell-labs.com/cm/cs/who/dmr/cacm.html">http://cm.bell-labs.com/cm/cs/who/dmr/cacm.html</a><br/>
<strong>published</strong>: ACM 1974</p>

<h3>The File System</h3>

<p>From the user&rsquo;s point of view, three kinds of files:</p>

<ol>
<li><strong>ordinary disk files</strong> - no particular structure expected by system. Structure of files is controlled by programs (object files generated by assembler). Could be binary files or simple text files.</li>
<li><strong>directories</strong> - mapping between the names of files and the files themselves.

<ul>
<li>System maintains several directories for its own use.

<ul>
<li><strong>root directory</strong>: the starting point for other files in the system.</li>
<li>directory that contains commands to be executed. (not required, for convinience since commands can be placed anywhere).</li>
<li>null filename refers to current directory.</li>
</ul>
</li>
<li>A non-directory file may appear in several other directories under different names. - <strong>linking</strong>

<ul>
<li>A directory entry for this file is called a <strong>link</strong></li>
<li><strong>Hard Links</strong>: <code>ln file1 file2</code> - file2 now links to file1. Both file1 and file2 have same status. File doesn&rsquo;t exist in any directory in general, the directory entry contains link between filename and a pointer to the information describing the file.</li>
</ul>
</li>
<li>Each directory has atleast two enteries with name &lsquo;.&rsquo; and &lsquo;..&rsquo; referring to current and parent directories resp.</li>
<li>The directory structure is constrained to have a rooted tree structure.</li>
<li>Cycles are not allowed in the file system. However Kernel mainains two restricted types of cycles in each directory: <code>.</code> and <code>..</code></li>
</ul>
</li>
<li><strong>special files</strong>: Each I/O device supported by UNIX is associated with at least one such file. Special files are read and written just like ordinary files. However, request to these files leads to activation of the associated device. An entry for each special devices exists in <code>/dev</code>.</li>
</ol>


<h3>Removable File Systems</h3>

<p>It is not necessary that the entire file system hierarchy reside on this device.</p>

<p><code>mount</code> causes the heretofore ordinary file to refer instead to the root directory of the file system on the removable volume. In effect, mount replaces a leaf of the hierarchy tree by a whole new subtree.</p>

<ul>
<li>No link may exist between one file system hierarchy and another.</li>
<li><strong>&lsquo;..&rsquo;</strong> refers to the directory itself instead to its parent.</li>
</ul>


<h3>Protection</h3>

<ol>
<li>Each user is assigned a unique user identification number. When a file is created it is marked with the user ID of the owner.</li>
<li>10 bits are used. 9 bits are used for R/W/X for self, group and others.</li>
<li>if the 10th bit is on, the system will temporarily change the user ID to the user ID of the user that created the file.</li>
</ol>


<h3>I/O Calls</h3>

<ol>
<li>There is no distinction between random and sequential I/O, nor is any logical record size imposed by system.</li>
<li>The size of the ordinary file is determined by the highest byte written on it; no predetermination of the size of a file is necessary or possible.</li>
<li>open / create system calls opens / creates file. There are no user-visible locks in the file system, nor is there any restriction on the number of users who may have a file open for reading or writing. The text may be scrambled if multiple users are writing at the same time.</li>
<li>System has sufficient interlocks present internally to maintain the logical consistency of the file system when two users are writing on same file, creating files in the same directory or deleting each other&rsquo;s open files.</li>
</ol>


<h3>Implementation of the File System</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Directory:
</span><span class='line'>  filename -&gt; pointer to file info [called i-number]</span></code></pre></td></tr></table></div></figure>


<p>When a file is accessed, it&rsquo;s <strong>i-number</strong> is used as an index into a system table (the <strong>i-list</strong>)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>users/myfile
</span><span class='line'>
</span><span class='line'>Directory: users
</span><span class='line'>myfile -&gt; 4;
</span><span class='line'>
</span><span class='line'>i-list (system table)
</span><span class='line'>0 - i-node1
</span><span class='line'>1 - i-node2
</span><span class='line'>...
</span><span class='line'>4 - i-node4</span></code></pre></td></tr></table></div></figure>


<h4>i-node</h4>

<p>Content of i-node:</p>

<ol>
<li>Its owner</li>
<li>Its protection bits</li>
<li>The physical disk or tape address for the file contents.</li>
<li>Its size</li>
<li>Time of last modification</li>
<li>The number of links to the file, that is, the number of times it appears in a directory.</li>
<li>A bit indicating whether the file is a directory</li>
<li>A bit indicating whether the file is a special file</li>
<li>A bit indicating whether the file is &ldquo;large&rdquo; or &ldquo;small&rdquo;</li>
</ol>


<p>The purpose of open/create call is to turn the pathname to i-number by searching the directories. Once a file is open, its device, i-number, and read/write pointer are stored in a system table indexed by the file descriptor return by open or create.</p>

<p>There is a space in i-node for 13 device addresses.</p>

<p>For special files 12 of the 13 devices addresses are ignored and the first specifies an internal device name, which is interpreted as a pair of numbers representing, resp, a device type and subdevice number. Device type -> system routine to deal with I/O on that device and SubDevice number -> selects a disk drive attached to a particular controller.</p>

<p><code>mount</code> system call maintains a system table whose arguments(keys) are (i-number, device name of the ordinary file specied in mount command) and value is device name of the indicated special file. This table is searched for i-number/device pair during an open/create. If the match is found the i-number is replaced by the root directory and the device name is replaced by table value.</p>

<h3>Processes and Images</h3>

<p>An <strong>image</strong> is a computer execution environment. It includes a memory image, general register value, status of open files and the like.</p>

<p>A <strong>process</strong> is execution of image.</p>

<p><code>fork</code>: to create a new process. The new processes after fork has copies of same image and share all open files.</p>

<h3>Implementation of Shell</h3>

<p>Shell most of the time waits for user to type command. At newline character shell&rsquo;s read calls returnds and shell analyzes the command line, putting the arg in form of <em>execute</em> and then the fork is called. The child process executes the command and parent process waits for the child process to finish. When child process finishes parent shell returns prompt back to the user.</p>

<p>Whenever &lsquo;&amp;&rsquo; is used, shell simply doesn&rsquo;t wait for the child process to finish before giving the prompt to user.</p>

<h3>Initializations</h3>

<p>The last in the initialization of unix is the creation of a single process and the invocation (via execute) of a program called <strong>init</strong>.</p>

<hr/>


<p>Paper further discusses about pipes, shell, filter, command seperators, implementation of shell using fork.</p>

<h2>Further Reading</h2>

<p><a href="../../../../2014/09/04/slash-udev-notes">More on /udev</a></p>

<p><img src="http://i.imgur.com/aC3F5Bo.png"></p>

<h3>Class Notes:</h3>

<p>To make a system call: <code>int 0x80</code> -> was expensive.</p>

<p>OSX is essentially a POSIX-compatible.</p>

<p>Soft Link is a file (directory) whose contents are the file name pointing to actual file.</p>

<p>In memory data structure for open files.</p>

<p>File system is a DAG (Directed Acyclic Graph)</p>

<p>File doesn&rsquo;t have a self link, whereas directory does.</p>

<p>Circular structures cannot be garbage collected based on reference count.</p>

<p><img class="left" src="http://i.imgur.com/C9dGPuy.png" width="420">
<img src="http://i.imgur.com/wob4kNr.png" width="420"></p>

<h3>mkfs</h3>

<p>From man page:</p>

<blockquote><p>mkfs is used to build a linux filesystem on a device, usually a hard disk partition. mkfs is usually a front-end for various filesystem builders (mkfs.fstype).</p></blockquote>

<p>The filesystem specific commands may be invoked directly. The convention is to name the commands as <code>mkfs.&lt;fs-type&gt;</code></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/notes-blog/blog/2014/09/01/unique-abbreviation-for-a-list-of-words/">Unique Abbreviation for a List of Words</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-01T07:41:51+05:30" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='problem-box'> <b> Problem: </b> Find unique abbreviation for a given list of words. </div>




<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;iostream&gt;</span>
<span class="cp">#include &lt;string&gt;</span>
<span class="cp">#include &lt;unordered_map&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;queue&gt;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="cm">/*</span>
<span class="cm"> * Method: abbreviateWord(string word, int offset)</span>
<span class="cm"> *</span>
<span class="cm"> * Example: internationalization, 1: i18n</span>
<span class="cm"> *          auto, 1: a2o</span>
<span class="cm"> *          automatic, 2: au5ic</span>
<span class="cm"> * */</span>

<span class="n">string</span> <span class="nf">abbreviateWord</span><span class="p">(</span><span class="n">string</span> <span class="n">word</span><span class="p">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">word</span><span class="p">.</span><span class="n">length</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">numeric_part</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">string</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">word</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
  <span class="n">string</span> <span class="n">suffix</span> <span class="o">=</span> <span class="n">word</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">length</span><span class="o">-</span><span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="o">-</span><span class="n">offset</span><span class="p">);</span>
  <span class="n">numeric_part</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">offset</span><span class="p">);</span>
  <span class="n">string</span> <span class="n">result</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">numeric_part</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">to_string</span><span class="p">(</span><span class="n">numeric_part</span><span class="p">)</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/** Returns unique mapping of abbreviations to words for a given list of words.</span>
<span class="cm"> * Input:</span>
<span class="cm"> * words: vector of words of string datatype.</span>
<span class="cm"> *</span>
<span class="cm"> * Return:</span>
<span class="cm"> * map with keys as abbreviations and values as the corressponding words.</span>
<span class="cm"> *</span>
<span class="cm"> * Example:</span>
<span class="cm"> * Input: [&quot;abcdef&quot;, &quot;abpqef&quot;, &quot;internationalization&quot;, &quot;something&quot;]</span>
<span class="cm"> * Output:</span>
<span class="cm"> *</span>
<span class="cm"> * acdef -&gt;  ac1ef</span>
<span class="cm"> * doordonotthereisnotry -&gt;  d19y</span>
<span class="cm"> * cool -&gt;  c2l</span>
<span class="cm"> * aqref -&gt;  aq1ef</span>
<span class="cm"> * internationalization -&gt;  i18n</span>
<span class="cm"> *</span>
<span class="cm"> * */</span>
<span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;&amp;</span> <span class="n">uniqueAbbreviation</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&amp;</span> <span class="n">words</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// maintain a hash map with abbv -&gt; word mapping.</span>
  <span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">abbvWord</span> <span class="o">=</span> <span class="k">new</span> <span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="c1">// maintain a queue for processing words.</span>
  <span class="n">queue</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">wordQueue</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// initial offset</span>
  <span class="c1">// loop until all done</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">it</span> <span class="p">:</span> <span class="n">words</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">wordQueue</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">string</span> <span class="n">word</span><span class="p">,</span> <span class="n">abbv</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">wordQueue</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
  <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wordQueue</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">wordQueue</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
    <span class="n">wordQueue</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>

    <span class="n">abbv</span> <span class="o">=</span> <span class="n">abbreviateWord</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">abbvWord</span><span class="p">)[</span><span class="n">abbv</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">(</span><span class="o">*</span><span class="n">abbvWord</span><span class="p">)[</span><span class="n">abbv</span><span class="p">]</span> <span class="o">=</span> <span class="n">word</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">wordQueue</span><span class="p">.</span><span class="n">push</span><span class="p">(((</span><span class="o">*</span><span class="n">abbvWord</span><span class="p">)[</span><span class="n">abbv</span><span class="p">]));</span>
      <span class="n">abbvWord</span><span class="o">-&gt;</span><span class="n">erase</span><span class="p">(</span><span class="n">abbv</span><span class="p">);</span>
      <span class="n">wordQueue</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">word</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">count</span><span class="o">--</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">count</span> <span class="o">=</span> <span class="n">wordQueue</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
      <span class="n">offset</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="o">*</span><span class="n">abbvWord</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Internationaalization, 1: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">abbreviateWord</span><span class="p">(</span><span class="s">&quot;internationalization&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Internationalization, 2: &quot;</span> <span class="o">&lt;&lt;</span>  <span class="n">abbreviateWord</span><span class="p">(</span><span class="s">&quot;internationalization&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;abcdef, 3: &quot;</span> <span class="o">&lt;&lt;</span>  <span class="n">abbreviateWord</span><span class="p">(</span><span class="s">&quot;abcdef&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">words</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;internationalization&quot;</span><span class="p">,</span> <span class="s">&quot;cool&quot;</span><span class="p">};</span>
  <span class="n">words</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;doordonotthereisnotry&quot;</span><span class="p">);</span>
  <span class="n">words</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;acdef&quot;</span><span class="p">);</span>
  <span class="n">words</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;aqref&quot;</span><span class="p">);</span>

  <span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">abbvWords</span> <span class="o">=</span> <span class="n">uniqueAbbreviation</span><span class="p">(</span><span class="n">words</span><span class="p">);</span>

  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">it</span> <span class="p">:</span> <span class="n">abbvWords</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="p">.</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; -&gt;  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/notes-blog/blog/2014/09/01/swap-using-reference/">Swap Using Reference</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-01T07:31:18+05:30" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='problem-box'> <b> Problem: </b> Write a method to swap two integers passed by reference. </div>




<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#include &lt;iostream&gt;</span>
<span class="c1">// swap using pointers</span>
<span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">temp</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;a = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;a = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/notes-blog/blog/2014/09/01/hola-mundo/">Hola Mundo</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-01T06:59:11+05:30" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='problem-box'> <b> Problem: </b> the hola mundo program. </div>




<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">HolaMundo</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello World!&quot;</span><span class="o">);</span> <span class="c1">// Display the string.</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre></div>



</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/notes-blog/blog/archives/"> Archives </a>
    
    <a class="next" href="4">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section id="titles">
  <a href="http://goyalankit.github.io/notes-blog" title="learn"><img id="logo" src="http://goyalankit.github.io/notes-blog/images/logo.png" /></a>
  <h1 id="site_title"><a href="http://goyalankit.github.io/notes-blog" title="learn">learn</a></h1>
  <h3 id="site_subtitle">just code</h3>
</section>

<section id="menu">
  <ul>
    <li><i class="fa fa-home fa-lg"></i><a href="http://goyalankit.github.io/notes-blog"> Home </a></li>
    <li><i class="fa fa-calendar fa-lg"></i><a href="http://goyalankit.github.io/notes-blog/blog/archives/"> Archives </a></li>
    <li><i class="fa fa-user fa-lg"></i><a href="http://goyalankit.github.io/notes-blog/about/"> About </a></li>
    <li><i class="fa fa-rss fa-lg"></i><a href="http://goyalankit.github.io/notes-blog/atom.xml"> Feed </a></li>
  </ul>
</section>

<section id="social">
  

  

  

  
    <a href="https://github.com/goyalankit" title="goyalankit"><i class="fa fa-github fa-2x"></i></a>
  

  

  
    <a href="https://twitter.com/_goyalankit" title="_goyalankit"><i class="fa fa-twitter fa-2x"></i></a>
  
</section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/notes-blog/blog/2014/11/18/concurrent-objects/">Concurrent Objects</a>
      </li>
    
      <li class="post">
        <a href="/notes-blog/blog/2014/11/13/papi-native-hardware-counters/">Papi native hardware counters</a>
      </li>
    
      <li class="post">
        <a href="/notes-blog/blog/2014/11/12/fast-paxos/">Fast Paxos</a>
      </li>
    
      <li class="post">
        <a href="/notes-blog/blog/2014/11/07/ruby-notes/">Ruby Notes</a>
      </li>
    
      <li class="post">
        <a href="/notes-blog/blog/2014/11/07/spanner-googles-globally-distributed-database/">Spanner: Google&#8217;s Globally Distributed Database</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/goyalankit">@goyalankit</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'goyalankit',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/notes-blog/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Ankit -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'goyalankit';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
